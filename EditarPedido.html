<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1, shrink-to-fit=no" />
    <title>CircularLink</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            position: relative
        }
    </style>
</head>

<body>
    <!-- Cabeçalho -->
    <nav class="navbar navbar-expand navbar-dark" style="background-color:rgb(51, 65, 29);">
        <a class="navbar-brand" href="./Socio.html">
            <img src="rec/CircularLink_logo.svg" alt="" width="45" height="45" />
        </a>
        <a class="navbar-brand" href="./Socio.html">CircularLink</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample02"
            aria-controls="navbarsExample02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarsExample02">
            <ul class="navbar-nav">
                <li class="nav-item" style="padding-right: 10px;">
                    <a class="nav-link active" href="Conta.html">
                        <img src="rec/user.png" alt="Conta" width="45" height="45" />
                    </a>
                </li>
                <li class="nav-item style=" style="padding-left: 10px;">
                    <a class="nav-link active" href="" onclick="return logout()">
                        <img src="rec/sair.png" alt="Sair" width="45" height="45" />
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <!-- Formulário -->
    <div class="container">
        <div id="aviso" class="mt-2 col-md-12" style="display: none;">
            <h1 class="text-danger"><i class="fa fa-warning ">Anúncio não encontrado.</i></h1>
        </div>
        <div id="anuncio" style="display: none;">
            <!-- Titulo + Imagem -->
            <div class="row">
                <div class="col-lg-7" style="padding: 10;">
                    <h2 style="margin-top:50px;color: forestgreen;"><b id="anuncioTitle"></b></h2>
                    <h5 id="anuncioDesc" class="p-heading p-large"></h5>
                </div>
                <div class="col-lg-5" style="padding: 0; text-align:center;margin-top:10px">
                    <div class="image-container" style="margin-top:10px">
                        <img id="anuncioImg" src="" class="img-fluid" style="height:240px" />
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- Ingredientes -->
                <div class="col-lg-8" style="padding: 10;">
                    <h3 style="margin-top:50px;color: forestgreen;"><b>Ingredientes</b></h3>
                    <h5 id="anuncioIngr" class="p-heading p-large"></h5>
                </div>
                <!-- Data de Concepçao -->
                <div class="col-lg-4" style="padding: 10;">
                    <h3 style="margin-top:50px;color: forestgreen;"><b>Data de
                            Concepção</b></h3>
                    <h4 id="anuncioDataCon" class="p-heading p-large font-weight-bold"></h4>
                </div>
            </div>

            <div class="row">
                <!-- Razão de Despacho -->
                <div class="col-lg-8" style="padding: 10;">
                    <h3 style="margin-top:10px;color: forestgreen;"><b>Razão de Despacho</b></h3>
                    <h5 id="anuncioRaz" class="p-heading p-large"></h5>
                </div>
                <!-- Data de Despacho -->
                <div class="col-lg-4" style="padding: 10;">
                    <h3 style="margin-top:10px;color: forestgreen;"><b>Data de Despacho</b></h3>
                    <h4 id="anuncioDataDesp" class="p-heading p-large font-weight-bold"></h4>
                </div>
            </div>
            <div class="row" style=" margin-top:20px;">
                <!-- Preço Original -->
                <div class="col-lg-3">
                    <h3 style="color: forestgreen;"><b>Preço Original</b></h3>
                </div>
                <div class="col-lg-1">
                    <h3 id="anuncioPreOri" class="p-heading p-large font-weight-bold"></h3>
                </div>
                <!-- Preço Atual -->
                <div class="col-lg-3" style="padding: 10;">
                    <h3 style="color: forestgreen;"><b>Preço de Venda</b></h3>
                </div>
                <div class="col-lg-1">
                    <h3 id="anuncioPreVen" class="p-heading p-large font-weight-bold"></h3>
                </div>
            </div>
            <!-- Estado -->
            <div class="row" style=" margin-top:20px;">
                <div class="col-lg-2">
                    <h3 style="color: forestgreen;"><b>Estado</b></h3>
                </div>
                <div class="col-lg-4">
                    <h3 id="anuncioStatus" class="p-heading p-large font-weight-bold"></h3>
                </div>
                <div class="col-lg-6" id="anuncioEdit">
                    <button class="btn btn-primary" type="button" onclick="changeConcluido()">Marcar como
                        Concluído</button>
                    <button class=" btn btn-danger" type="button" onclick="changeExpirado()">Marcar como
                        Expirado</button>
                </div>
            </div>
            <!-- Botões -->
            <div class=" d-grid gap-2 d-md-block" style="padding-top: 20px;">
                <a href="./Pedidos.html">
                    <button class="btn btn-secondary btn-lg" type="button">Voltar</button>
                </a>
            </div>
        </div>
    </div>
    </div>
    <script src="./Scripts/jquery-3.5.1.min.js"></script>
    <script src="./Scripts/bootstrap.min.js"></script>
    <script src="./Scripts/knockout-3.5.1.js"></script>
    <script src="./Scripts/amplify.js"></script>
    <script>
        function logout() {
            amplify.store('CurrentUser', null)
            go_to('./index.html')
        }
        function go_to(hr) {
            window.location.href = hr
        }
        function changeConcluido() {
            changeStatus("concluido")
        }
        function changeExpirado() {
            changeStatus("expirado")
        }
        function changeStatus(status) {
            pedidos[id].status = status
            amplify.store("pedidos", pedidos)
            go_to("./Pedidos.html")
        }
        $().ready(function () {
            // Verificar se existe login
            currUser = amplify.store('CurrentUser')
            if (currUser == undefined || currUser.status != "Socio")
                go_to("./index.html")

            // Obter id do anúncio
            id = window.location.href.toString().split("=")[1]
            pedidos = amplify.store("pedidos")
            // Verificar se anúncio existe e pertence ao utilizador atual
            if (id != undefined && pedidos[id] != undefined && pedidos[id].partnerID == currUser.p) {
                document.getElementById("anuncioTitle").innerHTML = pedidos[id].nome_p;
                document.getElementById("anuncioDesc").innerHTML = pedidos[id].descricao;
                document.getElementById("anuncioImg").src = pedidos[id].imgpath;
                document.getElementById("anuncioIngr").innerHTML = pedidos[id].ingredientes;
                document.getElementById("anuncioRaz").innerHTML = pedidos[id].rdespacho;
                document.getElementById("anuncioDataCon").innerHTML = pedidos[id].datas[0] + " " + pedidos[id].horas[0];
                document.getElementById("anuncioDataDesp").innerHTML = pedidos[id].datas[1] + " " + pedidos[id].horas[1];
                document.getElementById("anuncioPreOri").innerHTML = pedidos[id].precos[0] + "€";
                document.getElementById("anuncioPreVen").innerHTML = pedidos[id].precos[1] + "€";
                status = ""
                switch (pedidos[id].status) {
                    case "disponivel":
                        status = "Disponível"
                        color = "color: rgb(10, 190, 10)"
                        break
                    case "reservado":
                        status = "Reservado"
                        color = "color: rgb(170, 150, 20)"
                        break
                    case "concluido":
                        status = "Concluído"
                        color = "color: rgb(30, 30, 225)"
                        break
                    case "expirado":
                        status = "Expirado"
                        color = "color: rgb(255, 10, 60)"
                        break
                    default:
                        break
                }
                document.getElementById("anuncioStatus").style = color;
                document.getElementById("anuncioStatus").innerHTML = status;
                if (status == "Expirado" || status == "Concluído")
                    $('#anuncioEdit').hide()
                $('#anuncio').show()
            } else
                $('#aviso').show()

            console.log(id)


            $('#criar_pedido').click(function () {
                console.log($('#ing').val())
                console.log($('#despacho').val())
                if (validate()) {
                    addpedido()
                    alert('Pedido publicado com sucesso')
                    go_to("./Socio.html")
                }
            })

        })

    </script>
</body>

</html>