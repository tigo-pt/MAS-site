<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1, shrink-to-fit=no" />
    <title>CircularLink</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            position: relative
        }
    </style>
</head>

<body>
    <div class="container justify-content-center mt-5" style="text-align:center">
        <!-- Cabeçalho -->
        <div class="row mb-5 justify-content-center">
            <h1 class="display-3" style="font-weight:bolder">CircularLink</h1>
        </div>
        <div class="row mb-5 justify-content-center">
            <img class="img-fluid" src="Cataplana_v2.png" width="200" />
        </div>
        <div class="row mb-5 justify-content-center">
            <h2>"Combater o desperdício alimentar ao melhor preço"</h2>
        </div>

        <!-- Login -->
        <div class="form-group">
            <!-- Formulário -->
            <div class="form-inline mb-2">
                <input type="text" class="form-control m-auto" placeholder="Email" style="width:300px" id="email">
            </div>
            <div class="form-inline mb-2">
                <input type="password" class="form-control m-auto" placeholder="Password" style="width:300px"
                    id="palavra-passe">
            </div>
            <!-- Aviso -->
            <div id="aviso" class="mt-2 col-md-12" style="display: none;">
                <p class="text-danger"><i class="fa fa-warning ">Dados inválidos. Por favor tente novamente.</i></p>
            </div>
            <!-- Botões -->
            <div class="d-grid gap-2 col-5 mx-auto">
                <button onclick="login()" class="form-inline btn mb-2 btn-success btn-lg btn-block">Login</button>
                <a href="CriarConta.html" class="form-inline mb-2 btn btn-primary btn-lg btn-block">Criar conta</a>
            </div>
        </div>

        <div class="d-grid gap-2 d-md-block">


        </div>

    </div>
    <script src="./Scripts/jquery-3.5.1.min.js"></script>
    <script src="./Scripts/bootstrap.min.js"></script>
    <script src="./Scripts/knockout-3.5.1.js"></script>
    <script src="./Scripts/amplify.js"></script>

    <script>
        $().ready(function () {
            // Verificar se login já foi feito
            currUser = amplify.store('CurrentUser')
            console.log(currUser)
            if (currUser != undefined) {
                go_to(currUser.status)
            }
            // Criar uma lista de utilizadores caso não exista
            if (amplify.store('users') == undefined) {
                Carlos = {
                    'name': 'Carlos Silva',
                    'password': 'carlos',
                    'email': 'carlos@a.pt',
                    'status': 'Cliente',
                    'morada': 'Rua da Batalha Nr 22 Quinta do Simão, Aveiro',
                    'nif': '461781899',
                    'contacto': '923991960',
                    'p': 0,
                    'est': ''
                }
                Beta = {
                    'name': 'Beta',
                    'password': 'beta',
                    'email': 'beta@a.pt',
                    'status': 'Socio',
                    'morada': 'Estrada Nacional, 3800-233 Aveiro',
                    'nif': '461781899',
                    'contacto': '923991960',
                    'p': 1,
                    'est': 'Bom Gosto'
                }
                Test = {
                    'name': 'Cliente de Teste',
                    'password': 'user',
                    'email': 'user@user.com',
                    'status': 'Cliente',
                    'morada': 'A minha morada de casa',
                    'nif': 10000000 + Math.floor(Math.random() * 900000000),
                    'contacto': 900000000 + Math.floor(Math.random() * 100000000),
                    'p': 2,
                    'est': ''
                }
                Test2 = {
                    'name': 'Sócio de Teste',
                    'password': 'partner',
                    'email': 'partner@partner.com',
                    'status': 'Socio',
                    'morada': 'A minha morada de restaurante',
                    'nif': 10000000 + Math.floor(Math.random() * 900000000),
                    'contacto': 200000000 + Math.floor(Math.random() * 100000000),
                    'p': 3,
                    'est': 'O meu Restaurante'
                }
                users = [Carlos, Beta, Test, Test2]
                amplify.store('users', users)
            }
            users = amplify.store('users')
            console.log(users)
        })

        // Verificação do login
        function login() {
            v = false
            for (var i in users) {
                if (($('#email').val() == users[i].email) && ($('#palavra-passe').val() == users[i].password)) {
                    console.log('login bem sucedido')
                    $('#aviso').hide()
                    // Redirecionar para a página correspondente
                    amplify.store('CurrentUser', users[i])
                    go_to(users[i].status)
                    break
                }
            }
            // login sem sucesso
            if (amplify.store('CurrentUser') == undefined || amplify.store('CurrentUser') == null)
                $('#aviso').show()
        }
        // Redirecionar página
        function go_to(k) {
            window.location.href = k + '.html'
        }
    </script>
</body>

</html>